name: Deploy both Slidev projects (Algo1 & Algo2)

on:
  push:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js 20
        uses: actions/setup-node@v4
        with:
          node-version: 20

      # === Build Algo1 ===
      - name: Build Algo1 Slidev
        run: |
          set -e
          cd Algo1/algo1-slidev
          npm install
          npx slidev build
          mv dist ../../dist_Algo1

      # === Build Algo2 ===
      - name: Build Algo2 Slidev
        run: |
          set -e
          cd Algo2/algo2-slidev
          npm install
          npx slidev build
          mv dist ../../dist_Algo2

      # === Combine both and add index.html ===
      - name: Combine and prepare for deployment
        run: |
          set -e
          mkdir public
          mv dist_Algo1 public/Algo1
          mv dist_Algo2 public/Algo2
          cat <<EOF > public/index.html
          <!DOCTYPE html>
          <html>
          <head>
            <meta charset="utf-8">
            <title>My Slidev Projects</title>
            <style>
              body { font-family: sans-serif; text-align: center; margin-top: 60px; background: #111; color: #eee; }
              a { color: #00ccff; text-decoration: none; font-size: 1.2em; display: block; margin: 10px; }
              a:hover { text-decoration: underline; }
            </style>
          </head>
          <body>
            <h1>My Slidev Presentations</h1>
            <p><a href="Algo1/">ðŸ‘‰ Algo1 Presentation</a></p>
            <p><a href="Algo2/">ðŸ‘‰ Algo2 Presentation</a></p>
          </body>
          </html>
          EOF
          
      # === Deploy to GitHub Pages ===
      - name: Deploy to GitHub Pages
        id: deploy
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public
        continue-on-error: true

      # === Fallback jika gagal push (403 error) ===
      - name: Retry deploy with PERSONAL_TOKEN if default token fails
        if: steps.deploy.outcome == 'failure'
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.PERSONAL_TOKEN }}
          publish_dir: ./public
